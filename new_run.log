2025-12-20 10:18:42 - lead_enrichment - INFO - Starting Lead Enrichment Engine
2025-12-20 10:18:42 - lead_enrichment - INFO - Input file: tests/m3_test_data.xlsx
2025-12-20 10:18:42 - lead_enrichment - INFO - Reading Excel file...
2025-12-20 10:18:42 - lead_enrichment - INFO - Reading Excel file: tests/m3_test_data.xlsx
2025-12-20 10:18:42 - lead_enrichment - INFO - Detecting red rows in tests/m3_test_data.xlsx
2025-12-20 10:18:42 - lead_enrichment - INFO - Found 0 red rows: []
2025-12-20 10:18:42 - lead_enrichment - INFO - Read 20 rows, 0 marked as red
2025-12-20 10:18:42 - lead_enrichment - INFO - DEBUG read_excel: returning metadata with keys: dict_keys(['red_row_indices', 'red_df_indices', 'original_columns', 'filepath'])
2025-12-20 10:18:42 - lead_enrichment - INFO - DEBUG read_excel: metadata type: <class 'dict'>
2025-12-20 10:18:42 - lead_enrichment - INFO - DEBUG read_excel: metadata is None? False
2025-12-20 10:18:42 - lead_enrichment - INFO - DEBUG read_excel: metadata keys: dict_keys(['red_row_indices', 'red_df_indices', 'original_columns', 'filepath'])
2025-12-20 10:18:42 - lead_enrichment - INFO - Core orchestrator: processing 20 rows (skipping 0 red rows)
2025-12-20 10:18:42 - lead_enrichment - INFO - Loading priority rules from /Users/matiaswas/Code/MVPs/lead-enrichment-engine/config/rules/priority_rules.yaml
2025-12-20 10:18:42 - lead_enrichment - INFO - Priority engine initialized
2025-12-20 10:18:42 - lead_enrichment - INFO - Calculating priorities for 20 rows
2025-12-20 10:18:42 - lead_enrichment - INFO - Priority distribution: {3: 11, 1: 4, 2: 4, 4: 1}
2025-12-20 10:18:42 - lead_enrichment - INFO - Running Tier1 validation (CIF/NIF/NIE + Phone)...
Tier1 validation:   0%|          | 0/20 [00:00<?, ?it/s]Tier1 validation: 100%|██████████| 20/20 [00:00<00:00, 13304.69it/s]
2025-12-20 10:18:42 - lead_enrichment - INFO - Running Tier1 enrichment (phone finder + company name)...
Tier1 enrichment:   0%|          | 0/20 [00:00<?, ?it/s]2025-12-20T10:18:42 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:18:42 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa A SL'}
2025-12-20T10:18:42 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:43 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:44 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:   5%|▌         | 1/20 [00:01<00:29,  1.53s/it]2025-12-20T10:18:44 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:18:44 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa B SA'}
Tier1 enrichment:  10%|█         | 2/20 [00:01<00:15,  1.17it/s]2025-12-20T10:18:44 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:18:44 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa C SLU'}
2025-12-20T10:18:44 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:45 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:46 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  15%|█▌        | 3/20 [00:03<00:19,  1.16s/it]2025-12-20T10:18:46 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:18:46 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa D SL'}
2025-12-20T10:18:46 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:46 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:18:47 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  20%|██        | 4/20 [00:04<00:20,  1.31s/it]2025-12-20T10:18:47 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:18:47 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa E SA'}
2025-12-20T10:18:52 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': "HTTPSConnectionPool(host='another.com', port=443): Max retries exceeded with url: / (Caused by ConnectTimeoutError(<HTTPSConnection(host='another.com', port=443) at 0x10efdda00>, 'Connection to another.com timed out. (connect timeout=5)'))"}
2025-12-20T10:18:58 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': "HTTPSConnectionPool(host='another.com', port=443): Max retries exceeded with url: / (Caused by ConnectTimeoutError(<HTTPSConnection(host='another.com', port=443) at 0x10efdce00>, 'Connection to another.com timed out. (connect timeout=5)'))"}
2025-12-20T10:19:04 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'https://another.com', 'error': "HTTPSConnectionPool(host='another.com', port=443): Max retries exceeded with url: / (Caused by ConnectTimeoutError(<HTTPSConnection(host='another.com', port=443) at 0x10f0141a0>, 'Connection to another.com timed out. (connect timeout=5)'))"}
Tier1 enrichment:  25%|██▌       | 5/20 [00:21<01:41,  6.80s/it]2025-12-20T10:19:04 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:04 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa F SL'}
2025-12-20T10:19:04 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:04 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:05 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  30%|███       | 6/20 [00:23<01:10,  5.00s/it]2025-12-20T10:19:05 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:05 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa G SA'}
2025-12-20T10:19:05 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:06 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:07 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  35%|███▌      | 7/20 [00:24<00:50,  3.87s/it]2025-12-20T10:19:07 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:07 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa H SL'}
Tier1 enrichment:  40%|████      | 8/20 [00:25<00:33,  2.79s/it]2025-12-20T10:19:07 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:07 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa I SA'}
2025-12-20T10:19:07 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:08 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:09 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  45%|████▌     | 9/20 [00:26<00:26,  2.40s/it]2025-12-20T10:19:09 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:09 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa J SL'}
2025-12-20T10:19:09 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:09 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:10 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  50%|█████     | 10/20 [00:28<00:21,  2.13s/it]2025-12-20T10:19:10 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:10 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa K SL'}
Tier1 enrichment:  55%|█████▌    | 11/20 [00:29<00:17,  1.95s/it]2025-12-20T10:19:12 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:12 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa L SA'}
2025-12-20T10:19:12 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:12 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:13 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  60%|██████    | 12/20 [00:31<00:14,  1.82s/it]2025-12-20T10:19:13 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:13 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa M SL'}
Tier1 enrichment:  65%|██████▌   | 13/20 [00:31<00:10,  1.44s/it]2025-12-20T10:19:14 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:14 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa N SA'}
2025-12-20T10:19:14 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:14 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:15 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  70%|███████   | 14/20 [00:33<00:08,  1.47s/it]2025-12-20T10:19:15 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:15 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa O SL'}
2025-12-20T10:19:15 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:16 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:17 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  75%|███████▌  | 15/20 [00:34<00:07,  1.49s/it]2025-12-20T10:19:17 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:17 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa P SA'}
2025-12-20T10:19:17 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:17 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:18 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  80%|████████  | 16/20 [00:36<00:05,  1.50s/it]2025-12-20T10:19:18 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:18 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa Q SL'}
Tier1 enrichment:  85%|████████▌ | 17/20 [00:37<00:03,  1.33s/it]2025-12-20T10:19:19 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:19 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa R SA'}
2025-12-20T10:19:19 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:20 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:21 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  90%|█████████ | 18/20 [00:38<00:02,  1.39s/it]2025-12-20T10:19:21 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:21 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa S SL'}
2025-12-20T10:19:21 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:21 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:22 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment:  95%|█████████▌| 19/20 [00:40<00:01,  1.43s/it]2025-12-20T10:19:22 CRITICAL tier1.rate_limiter Rate limit CRITICAL threshold reached | extra={'provider': 'google_places', 'used': 200, 'limit': 200}
2025-12-20T10:19:22 WARNING tier1.google_places Google Places rate limit exceeded, skipping call | extra={'company_name': 'Empresa T SA'}
2025-12-20T10:19:22 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 1, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:23 WARNING tier1.retry._fetch Retryable error, will retry | extra={'attempt': 2, 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
2025-12-20T10:19:24 WARNING tier1.web_scraper Web scraper failed to fetch website | extra={'website': 'nan', 'error': 'HTTPSConnectionPool(host=\'nan\', port=443): Max retries exceeded with url: / (Caused by NameResolutionError("HTTPSConnection(host=\'nan\', port=443): Failed to resolve \'nan\' ([Errno 8] nodename nor servname provided, or not known)"))'}
Tier1 enrichment: 100%|██████████| 20/20 [00:41<00:00,  1.46s/it]Tier1 enrichment: 100%|██████████| 20/20 [00:41<00:00,  2.09s/it]
2025-12-20 10:19:24 - lead_enrichment - INFO - Starting Tier3 enrichment + validation + scoring...
2025-12-20 10:19:24 - lead_enrichment - INFO - Running Tier3 enrichment (WEBSITE, CNAE)...
2025-12-20 10:19:24 - lead_enrichment - INFO - Enriching WEBSITE for 14 rows
2025-12-20 10:19:24 - lead_enrichment - INFO - Enriching CNAE for 12 rows
2025-12-20 10:19:24 - lead_enrichment - INFO - Running batch email validation...
2025-12-20 10:19:24 - lead_enrichment - INFO - Validating emails for 20 rows
2025-12-20T10:19:26 WARNING tier2.email_validator DNS query timeout | extra={'domain': 'example.com'}
2025-12-20T10:19:26 INFO tier2.email_validator No MX record found | extra={'domain': 'test.com'}
2025-12-20T10:19:26 INFO tier2.email_validator No MX record found | extra={'domain': 'company.com'}
2025-12-20 10:19:26 - lead_enrichment - INFO - Email validation complete
2025-12-20 10:19:26 - lead_enrichment - INFO - Running batch phone validation...
2025-12-20 10:19:26 - lead_enrichment - INFO - Validating phones for 20 rows
2025-12-20 10:19:26 - lead_enrichment - INFO - Phone validation complete
2025-12-20 10:19:26 - lead_enrichment - INFO - Running CIF revalidation...
2025-12-20 10:19:26 - lead_enrichment - INFO - Revalidating CIFs for 19 rows
2025-12-20 10:19:26 - lead_enrichment - INFO - CIF revalidation complete
2025-12-20 10:19:26 - lead_enrichment - INFO - Calculating data quality scores...
2025-12-20 10:19:26 - lead_enrichment - INFO - Tier3, validation, and scoring complete
2025-12-20 10:19:26 - lead_enrichment - INFO - Writing output to: /Users/matiaswas/Downloads/ale/LIMPIO_m3_test_data.xlsx
2025-12-20 10:19:26 - lead_enrichment - INFO - Writing Excel file: /Users/matiaswas/Downloads/ale/LIMPIO_m3_test_data.xlsx
2025-12-20 10:19:26 - lead_enrichment - INFO - DEBUG write_excel: metadata type: <class 'dict'>
2025-12-20 10:19:26 - lead_enrichment - INFO - DEBUG write_excel: metadata value: {'red_row_indices': [], 'red_df_indices': [], 'original_columns': ['CIF', 'RAZON_SOCIAL', 'TELEFONO', 'EMAIL', 'CONSUMO_MWH', 'LUZ', 'GAS', 'WEBSITE', 'CNAE', 'OBSERVACIONES', '_IS_RED_ROW'], 'filepath': 'tests/m3_test_data.xlsx'}
2025-12-20 10:19:26 - lead_enrichment - INFO - DEBUG write_excel: metadata is None? False
2025-12-20 10:19:26 - lead_enrichment - INFO - DEBUG write_excel: metadata keys: dict_keys(['red_row_indices', 'red_df_indices', 'original_columns', 'filepath'])
2025-12-20 10:19:26 - lead_enrichment - INFO - Excel file written with format preservation: /Users/matiaswas/Downloads/ale/LIMPIO_m3_test_data.xlsx
2025-12-20 10:19:26 - lead_enrichment - INFO - ✅ Processing complete!
2025-12-20 10:19:26 - lead_enrichment - INFO - Output file: /Users/matiaswas/Downloads/ale/LIMPIO_m3_test_data.xlsx
2025-12-20 10:19:26 - lead_enrichment - INFO - Total rows processed (non-red): 20
2025-12-20 10:19:26 - lead_enrichment - INFO - CIF validated: 1/20
2025-12-20 10:19:26 - lead_enrichment - INFO - Phone found: 2/20
2025-12-20 10:19:26 - lead_enrichment - INFO - --- Tier3 Statistics ---
2025-12-20 10:19:26 - lead_enrichment - INFO - Websites enriched: 6/20
2025-12-20 10:19:26 - lead_enrichment - INFO - CNAE enriched: 8/20
2025-12-20 10:19:26 - lead_enrichment - INFO - Valid emails: 13/20
2025-12-20 10:19:26 - lead_enrichment - INFO - Valid phones: 0/20
2025-12-20 10:19:26 - lead_enrichment - INFO - High quality leads: 5/20
